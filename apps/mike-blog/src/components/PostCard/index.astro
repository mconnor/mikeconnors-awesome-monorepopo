---
import { z } from 'astro:content';
import { blogSchema } from '#schemas/index.ts';
import { format } from 'date-fns';
import { Image } from 'astro:assets';

interface Props {
  data: z.infer<typeof blogSchema>;
  href: string;
  showTags?: boolean;
}

const { href, data, showTags = false } = Astro.props;

const { cover, title, description, tags, date } = data;
---

<div
  class="card max-w-78 bg-base-100 card-sm md:card-md lg:card-lg shadow-sm md:max-w-96"
>
  {
    cover ?
      <figure>
        <Image src={cover.src} alt={cover.alt} width="1600" height="900" />
      </figure>
    : <div class="inheritRadius from-error via-warning to-success animate-gradient-shift size-full bg-gradient-to-br" />
  }

  <a
    href={`/posts/${href}`}
    class="absolute inset-0 z-10 rounded-2xl"
    aria-label="Full card link"></a>

  <div class="card-body">
    {date && <div class="text-sm">{format(date, 'yyyy-MM-dd')}</div>}
    <h2 class="card-title line-clamp-1">{title}</h2>

    <p class="line-clamp-3">{description}</p>

    <div class="card-actions justify-end">
      {
        showTags &&
          tags.map((tag) => (
            <a href={`/tags/${tag}`} class="badge badge-sm z-10">
              {tag}
            </a>
          ))
      }
    </div>
  </div>
</div>

<style>
  .inheritRadius {
    overflow: hidden;
    border-start-start-radius: inherit;
    border-start-end-radius: inherit;
    border-end-start-radius: unset;
    border-end-end-radius: unset;
  }

  @keyframes gradient-shift {
    0%,
    100% {
      background-size: 200% 200%;
      background-position: left center;
    }
    50% {
      background-size: 200% 200%;
      background-position: right center;
    }
  }

  .animate-gradient-shift {
    background-size: 200% 200%;
    animation: gradient-shift 6s ease-in-out infinite;
  }
</style>
