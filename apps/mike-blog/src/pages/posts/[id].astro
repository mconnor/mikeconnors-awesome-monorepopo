---
import { getCollection, render, getEntries } from 'astro:content';
import MarkdownPostLayout from '#layouts/MarkdownPostLayout.astro';
import CardAuthor from '#components/CardAuthor/index.astro';
// STATIC SITE GENERATION
// This page is statically generated at build time using Astro's getStaticPaths
// and prerendering capabilities. It fetches all blog posts and generates a static page for each.
// export const prerender = true;
export async function getStaticPaths() {
  const posts = await getCollection('blog');

  return posts.map((post) => ({
    params: { id: post.id },
    props: { post },
  }));
}

// const { id } = Astro.params;
const { post } = Astro.props;

// const authorData =
//   post.data.author ?
//     await getEntry(post.data.author.collection, post.data.author.id)
//   : null;
// console.log('______');
// console.log('post.data' + post.data);
const { data } = post;
const authorsArray = await getEntries(data.author);

const { Content } = await render(post);
---

<MarkdownPostLayout {...data}>
  <!-- <Debug post.id={post.id} /> -->

  <Content />
  <div slot="authors">
    <div class="flex justify-around">
      {
        authorsArray &&
          authorsArray.map((author) => (
            <a class="link" href={'/authors/' + author.id}>
              {author.data.name}
            </a>
          ))
      }
    </div>
  </div>
</MarkdownPostLayout>
